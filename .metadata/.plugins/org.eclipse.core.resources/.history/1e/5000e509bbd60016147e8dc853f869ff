package ie.gmit.sw;

/**
 * 
 * This class is used to find efferent couplings in each class in the jar file. The class implements the 
 * interface Calculator so it has to fulfill its contract of calculating
 *
 */
public class Efferent 
{
	
	private ClassList ClassListDependencies;
	private ClassList ClassListClasses;
	private Class<?> cls;
	private ReflectionExample ch = new ReflectionExample(cls);
	
	/**
	 *  This constructor is used to pass over and initialize the list of classes from jar file,
	 *  it also initializes a Class. The calculate method is also called.
	 * 
	 * @param class1 A particular class passed over to be initialized
	 * @param ClassList A list of the classes from the jar file
	 */
	public Efferent(Class<?> class1, ClassList ClassList) 
	{
		
		this.cls = class1;
		this.ClassListClasses = ClassList;
		
		calculate();
		
	}
	
	/**
	 * 
	 * This method is used to calculate the efferent couplings in each class.
	 * It calls classes which uses the reflection api to find out the contents of the class
	 * 
	 */
	public void calculate()
	{
		
		this.ClassListDependencies = new ClassList();
		
		ClassList inFace = ch.getInterface(this.cls);
		
		if(inFace.size() > 0){
			
			for (int i = 0; i < inFace.size(); i++) {
				
				this.ClassListDependencies.add(inFace.get(i));
				
			}
			
		}// End if
		
		// -----------------------------------------------------------------
		// 						Get superclass
		Class<?> superCls = ch.getSuperClass(this.cls, this.ClassListClasses);
		
		if(superCls != null)
		{
			
			this.ClassListDependencies.add(superCls);
			
		}
		// -----------------------------------------------------------------
		
		// -----------------------------------------------------------------
		//						Get Fields
		ClassList jarSetFields = ch.getFields(this.cls, this.ClassListClasses);
		filter(jarSetFields);
		// -----------------------------------------------------------------
		
		// ---------------------------------------------------------------------------
		// 						Get constructor parameters
		ClassList jarsetConParam = ch.getConstructorParams(this.cls, this.ClassListClasses);
		filter(jarsetConParam);
		// ---------------------------------------------------------------------------
		
		// --------------------------------------------------------------------
		// 						Get method parameters
		ClassList methodParams = ch.getMethodParams(this.cls, this.ClassListClasses);
		filter(methodParams);
		// --------------------------------------------------------------------
		
		// --------------------------------------------------------------------
		// 						Get method return type
		ClassList methodReturn = ch.getMethodReturn(this.cls, this.ClassListClasses);
		filter(methodReturn);
		// --------------------------------------------------------------------

	}// End calculate

	/**
	 * This method is used to retrieve a single class
	 * 
	 * @return A class type is returned
	 */
	public Class<?> getCls() 
	{
		return cls;
	}

	/**
	 * This method finds if a class is contained in the list and if it isn't then 
	 * it's added to a list containing dependencies
	 * 
	 * @param ClassList A list of classes from the jar 
	 */
	private void filter(ClassList ClassList)
	{
		
		if(ClassList.size() > 0)
		{
			
			for (int i = 0; i < ClassList.size(); i++) 
			{
				
				if(!ClassListDependencies.contains(ClassList.get(i)))
				{
					
					this.ClassListDependencies.add(ClassList.get(i));
					
				}
				
			}
		}
		
	}
	
	/**
	 * This method is used to get a list of classes that all have dependencies
	 * 
	 * @return A type of ClassList is returned which contains a list
	 */
	public ClassList getJarSetDependencies() 
	{
		return ClassListDependencies;
	}

	/**
	 * This method initializes a ClassList list that belongs to this class
	 * 
	 * @param ClassListDependencies A ClassList type is passed in
	 */
	public void setJarSetDependencies(ClassList ClassListDependencies)
	{
		this.ClassListDependencies = ClassListDependencies;
	}
	
	/**
	 * This method is used to return the number of dependencies
	 * 
	 * @return  A double is returned that represents the number of dependencies a class has
	 */
	public double getResult() 
	{
		return (double)ClassListDependencies.size();
	}
		
}
